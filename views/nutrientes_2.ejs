<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nutrientes</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/responsive.css" />
  <link rel="icon" href="/images/fevicon.png" type="image/gif" />
  <link rel="stylesheet" href="/css/jquery.mCustomScrollbar.min.css" />
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
</head>
<body class="main-layout">
  <!-- Loader -->
  <div class="loader_bg">
    <div class="loader"><img src="/images/loading.gif" alt="#" /></div>
  </div>

  <!-- Header -->
  <header>
    <div class="header">
      <div class="container-fluid">
        <div class="row">
          <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
            <div class="full">
              <div class="center-desk">
                <div class="logo">
                  <a href="/"><img src="/images/ods_14_icon.jpg" alt="#" /></a>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
            <div class="header_information">
              <nav class="navigation navbar navbar-expand-md navbar-dark">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04">
                  <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarsExample04">
                  <ul class="navbar-nav mr-auto">
                    <li class="nav-item active"><a class="nav-link" href="/indicesbio">Indices Biologicos</a></li>
                    <li class="nav-item"><a class="nav-link" href="/nutrientes_2">Nutrientes</a></li>
                    <li class="nav-item"><a class="nav-link" href="/elementosFisicoquimicos">Elementos Fisioquimicos</a></li>
                    <li class="nav-item"><a class="nav-link" href="/temperatura">Temperatura Media de las Aguas</a></li>
                  </ul>
                </div>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Contenido -->
  <div class="container mt-5 mb-5">
    <h2 class="text-center mb-4">Promedio de Nutrientes por A√±o y Categor√≠a</h2>
    <canvas id="nutrientesChart" width="400" height="200"></canvas>
  </div>


<section class="container mt-4 mb-5">
  <div class="card p-4 shadow-sm">
    <h4 class="text-center mb-4">üß™ Contexto de los Nutrientes Analizados</h4>
    <ul class="list-unstyled">
      <li class="mb-3">
        <strong>üîπ Nitratos (NO‚ÇÉ‚Åª):</strong> Presentan altos niveles en zonas agr√≠colas como Osona o el Llu√ßan√®s, debido al uso intensivo de fertilizantes y purines ganaderos. Contaminan acu√≠feros y afectan la calidad del agua.
      </li>
      <li class="mb-3">
        <strong>üîπ Fosfatos (PO‚ÇÑ¬≥‚Åª):</strong> Provienen de aguas residuales urbanas y productos de limpieza. Aunque no se detectan aumentos recientes, pueden causar eutrofizaci√≥n si se acumulan.
      </li>
      <li class="mb-3">
        <strong>üîπ Amonio (NH‚ÇÑ‚Å∫):</strong> Se asocia a materia org√°nica en descomposici√≥n y sequ√≠as. No se identifican niveles saludables para el mar catal√°n, pero en agua potable oscilan entre 27.7 y 55.5 ¬µmol/L.
      </li>
      <li class="mb-3">
        <strong>üîπ Silicatos (SiO‚ÇÑ‚Å¥‚Åª):</strong> Esenciales para organismos como las diatomeas. Su origen es natural (erosi√≥n y aguas subterr√°neas). No se detectan cambios preocupantes en el mar.
      </li>
      <li class="mb-3">
        <strong>üîπ Nitritos (NO‚ÇÇ‚Åª):</strong> Indicadores de contaminaci√≥n por fertilizantes o vertidos. Seg√∫n normativa espa√±ola, los niveles de referencia deben mantenerse por debajo de 0,92 ¬µmol/L en aguas protegidas.
      </li>
    </ul>
  </div>
</section>



  <!-- Footer -->
  <footer>
    <div class="footer">
      <div class="container">
        <div class="row border-top">
          <div class="col-md-6 padding_bottom1">
            <h3>Subscribe Now</h3>
            <form class="footer_form">
              <input class="enter" placeholder="Enter your email" type="email" name="email">
              <button class="submit">submit</button>
            </form>
          </div>
          <div class="col-md-6">
            <div class="row">
              <div class="col-md-5 offset-md-1 padding_bottom1">
                <h3>Links</h3>
                <ul class="cont">
                  <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <p>Grupo 4, ODS 14</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>





  <!-- Scripts -->
  <script src="/js/jquery.min.js"></script>
  <script src="/js/popper.min.js"></script>
  <script src="/js/bootstrap.bundle.min.js"></script>
  <script src="/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="/js/custom.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  const rawData = <%- JSON.stringify(datos) %>;

  // Rango sano por categor√≠a (en ¬µmol/L)
  const rangosSanos = {
    'Fosfats': { min: 0.05, max: 0.5 },
    'Nitrats': { min: 0.5, max: 5.0 },
    'Silicats': { min: 1.5, max: 10.0 }
  };

  const categorias = [...new Set(rawData.map(d => d.Categoria))];
  const a√±os = [...new Set(rawData.map(d => d.Any))].sort();

  // Crear datasets de l√≠neas principales (por categor√≠a)
  const datasets = categorias.map(categoria => {
    return {
      label: categoria,
      data: a√±os.map(a√±o => {
        const item = rawData.find(d => d.Any === a√±o && d.Categoria === categoria);
        return item ? item.Promedio : null;
      }),
      fill: false,
      borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
      tension: 0.3
    };
  });

  // A√±adir l√≠neas horizontales de rango sano
  categorias.forEach(categoria => {
    const rango = rangosSanos[categoria];
    if (rango) {
      datasets.push({
        label: `M√≠n. sano - ${categoria}`,
        data: new Array(a√±os.length).fill(rango.min),
        borderColor: 'green',
        borderDash: [10, 5],
        pointRadius: 0,
        fill: false,
        tension: 0,
        borderWidth: 1
      });
      datasets.push({
        label: `M√°x. sano - ${categoria}`,
        data: new Array(a√±os.length).fill(rango.max),
        borderColor: 'red',
        borderDash: [10, 5],
        pointRadius: 0,
        fill: false,
        tension: 0,
        borderWidth: 1
      });
    }
  });

  const ctx = document.getElementById('nutrientesChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: a√±os,
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: true,
          text: 'Promedio de Nutrientes y Rangos Saludables'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Promedio (¬µmol/L)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'A√±o'
          }
        }
      }
    }
  });
</script>

</body>
</html>
