<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard - Calidad del Agua</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/responsive.css" />
  <link rel="icon" href="/images/fevicon.png" type="image/gif" />
  <link rel="stylesheet" href="/css/jquery.mCustomScrollbar.min.css" />
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
.dashboard-container {
      background-color: #f8f9fa;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.12);
      padding: 30px;
      margin: 0 auto 40px;
      width: 95%;
      max-width: 1400px;
    }
    .chart-row {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 25px;
      gap: 25px;
    }
    .chart-col {
      flex: 1;
      min-width: 350px;
    }
    .half-height {
      height: 380px !important;
    }
    .full-height {
      height: 600px !important;
    }
    .chart-title {
      font-size: 19px;
      font-weight: bold;
      margin-bottom: 18px;
      text-align: center;
      color: #2c3e50;
      padding: 0 10px;
    }
    .chart-container {
      background-color: white;
      border-radius: 10px;
      padding: 22px;
      box-shadow: 0 0 10px rgba(0,0,0,0.08);
      height: 100%;
    }
    .wide-col {
      flex: 2.5;
      min-width: 500px;
      height: 380px;
    }
    .narrow-col {
      flex: 1;
      min-width: 350px;
    }
    .dashboard-description {
      background-color: #e9f5ff;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      border-left: 5px solid #2c3e50;
      font-size: 16px;
      line-height: 1.6;
    }
    @media (max-width: 1200px) {
      .dashboard-container {
        width: 98%;
        padding: 25px;
      }
      .chart-row {
        gap: 20px;
      }
    }
    @media (max-width: 768px) {
      .dashboard-container {
        width: 100%;
        padding: 20px;
        border-radius: 8px;
      }
      .chart-col, .wide-col, .narrow-col {
        min-width: 100%;
      }
      .half-height, .full-height {
        height: auto !important;
        min-height: 300px;
      }
    }
  </style>
</head>
<body class="main-layout">
  

  <!-- Header -->
  <header>
    <div class="header">
      <div class="container-fluid">
        <div class="row">
          <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
            <div class="full">
              <div class="center-desk">
                <div class="logo">
                  <a href="/"><img src="/images/ods_14_icon.jpg" alt="#" /></a>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
            <div class="header_information">
              <nav class="navigation navbar navbar-expand-md navbar-dark">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04">
                  <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarsExample04">
                  <ul class="navbar-nav mr-auto">
                    <li class="nav-item active"><a class="nav-link" href="/indicesbio">Indices Biologicos</a></li>
                    <li class="nav-item"><a class="nav-link" href="/nutrientes_2">Nutrientes</a></li>
                    <li class="nav-item"><a class="nav-link" href="/elementosFisicoquimicos">Elementos Fisioquimicos</a></li>
                    <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>
                  </ul>
                </div>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


 <!-- Contenido -->
  <div class="container-fluid mt-5 mb-5 px-4">
    <h2 class="text-center mb-4">Impacto de la Gestión Terrestre en los Ecosistemas Acuáticos</h2>
    
    <div class="dashboard-container">
      <!-- Primera fila: Temperatura (más ancho) y pH -->
      <div class="chart-row">
        <div class="chart-col wide-col">
          <div class="chart-title">Distribución de Temperatura por Comarca</div>
          <div class="chart-container">
            <div id="temperaturaChart" class="half-height"></div>
          </div>
        </div>
        <div class="chart-col narrow-col">
          <div class="chart-title">pH Promedio por Comarca Costera</div>
          <div class="chart-container">
            <canvas id="phChart" class="half-height"></canvas>
          </div>
        </div>
      </div>
      

      
      <!-- Segunda fila: Residuos Municipales -->
      <div class="chart-row">
        <div class="chart-col">
          <div class="chart-title">Residuos Municipales (Kg/hab/año)</div>
          <div class="chart-container">
            <canvas id="residuosChart" class="full-height"></canvas>
          </div>
        </div>
      </div>


      <br>
    
      <!-- Descripción del dashboard -->
      <div class="dashboard-description">
        <h3 class="text-center mb-3">Descripción</h3>
        <p>Este dashboard muestra cómo la gestión de nuestros residuos en tierra y el tratamiento del agua impactan directamente en la química (pH) y las condiciones (temperatura) de nuestros ecosistemas acuáticos. Estos factores, a su vez, son cruciales para la salud de la vida submarina, el objetivo principal del ODS 14. En resumen, menos residuos y mejor tratamiento del agua significan aguas más limpias y un pH adecuado, esenciales para proteger la vida en nuestros ríos y mares.</p>
      </div>

      <!--Fuentes-->
    
      <div class="dashboard-description">
        <h3 class="text-center mb-3">Fuentes</h3>
        <a href="https://analisi.transparenciacatalunya.cat/Medi-Ambient/Xarxes-de-control-del-medi-consulta-de-l-aigua-i-e/wc95-u57z/about_data"><p>Dades Obertes de Catalunya consulta de l'aigua</p></a>
       <a href="https://analisi.transparenciacatalunya.cat/?sortBy=relevance&page=1&pageSize=20"><p>Dades Obertes de Catalunya</p></a>
       <a href="https://www.ine.es/"><p>INE</p></a>
      </div>


    </div>
  </div>




  <!-- Footer -->
  <footer>
    <div class="footer">
      <div class="container">
        <div class="row border-top">
          <div class="col-md-6 padding_bottom1">
            <h3>Subscribe Now</h3>
            <form class="footer_form">
              <input class="enter" placeholder="Enter your email" type="email" name="email">
              <button class="submit">submit</button>
            </form>
          </div>
        <div class="copyright">
          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <p>Grupo 4, ODS 14</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="/js/jquery.min.js"></script>
  <script src="/js/popper.min.js"></script>
  <script src="/js/bootstrap.bundle.min.js"></script>
  <script src="/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="/js/custom.js"></script>

  <script>
    const temperatura = <%- JSON.stringify(temperatura) %>;
    const ph = <%- JSON.stringify(ph) %>;
    const residuos = <%- JSON.stringify(residuos) %>;

    // --- Temperatura con Plotly (Violin Plot) ---
    const tempLabels = [...new Set(temperatura.map(d => d.Comarca))];
    
    const violinData = tempLabels.map(label => {
      const values = temperatura.filter(d => d.Comarca === label).map(d => d.Valor);
      return {
        x: values,  
        y: Array(values.length).fill(label),
        name: label,
        type: 'violin',
        box: { visible: true },
        orientation: 'h',
        with: 0.5,
        meanline: { visible: true },
        points: 'false',
        width: 0.8,
        spanmode: 'hard'
      };
    });

    const layout = {
      margin: { t: 40, b: 80, l: 120, r: 50 },
      yaxis: { 
        title: { text: 'Comarca', standoff: 15, font: {size: 14} },
        automargin: true,
        gridcolor: '#f0f0f0',
        tickmode: 'array', 
        tickvals: tempLabels,
        ticktext: tempLabels
      },
      xaxis: { 
        title: { text: 'Temperatura (°C)', standoff: 10, font: {size: 14} },
        automargin: true,
        gridcolor: '#f0f0f0'
      },
      violingap: 0.8,
      violingroupgap: 0.6,
      width: null,
      height: 400,
      autosize: true,
      plot_bgcolor: 'rgba(0,0,0,0)',
      paper_bgcolor: 'rgba(0,0,0,0)',
      font: {
        family: 'Arial, sans-serif',
        size: 12,
        color: '#333'
      }
    };

    Plotly.newPlot('temperaturaChart', violinData, layout, {responsive: true});
    // --- pH ---
    const phLabels = ph.map(d => d.Comarca);
    const phData = ph.map(d =>  parseFloat(d.Valor.toFixed(3)));
    const phTratamientos = ph.map(d => d.Tratamientos || '');

    new Chart(document.getElementById('phChart'), {
      type: 'bar',
      data: {
        labels: phLabels,
        datasets: [{
          label: 'pH promedio',
          data: phData,
          backgroundColor: 'rgba(54, 162, 235, 0.6)'
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {

            callbacks: {
              afterLabel: function(context) {
                return 'Tratamientos: ' + phTratamientos[context.dataIndex];
              }
            }
            
          }
        },
        scales: {
          x: {
            min: 6.0,
            max: 9.0,
            title: { display: true, text: 'pH promedio' }
          }
        }
      }
    });

    // --- Residuos ---
    const residuosLabels = residuos.map(d => d.Comarca);
    const residuosData = residuos.map(d => d['Kg / hab / any']);

    new Chart(document.getElementById('residuosChart'), {
      type: 'bar',
      data: {
        labels: residuosLabels,
        datasets: [{
          label: 'Kg / hab / año',
          data: residuosData,
          backgroundColor: 'rgba(75, 192, 192, 0.6)'
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: 'Residuos Municipales por Comarca',
            font: { size: 16 }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Kg / habitante / año' }
          }
        }
      }
    });
  </script>
</body>
</html>